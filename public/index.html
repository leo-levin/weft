<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WEFT Playground</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="editor-highlighting.css">
</head>
<body>
<div id="app">
  <!-- Top Toolbar -->
  <header id="topbar">
    <div id="topbar-left">
    </div>
    <div id="topbar-center">
      <button id="playPauseBtn" type="button" class="primary-btn">▶</button>
      <button id="runBtn">Run</button>
    </div>
    <div id="topbar-right">
      <span class="pill" id="clockDisplay">0.00s</span>
      <span class="pill" id="fpsPill">60fps</span>
      <span class="pill" id="resPill">360×202</span>
      <button id="settingsBtn" type="button" title="Settings">⋯</button>
    </div>
  </header>

  <!-- Main Content Area -->
  <main id="mainContent">
    <!-- Left Panel: Code Editor -->
    <div id="editorPanel">
      <div id="editorContainer"></div>
      <div id="errors"></div>
    </div>

    <!-- Right Panel: Canvas + Inspector -->
    <div id="outputPanel">
      <!-- Canvas (always visible) -->
      <div id="canvasContainer">
        <canvas id="out" width="160" height="90"></canvas>
      </div>

      <!-- Inspector Panel -->
      <div id="inspectorPanel">
        <div id="inspectorTabs">
          <button class="inspector-tab active" data-tab="inspect">Inspect</button>
          <button class="inspector-tab" data-tab="debug">Debug</button>
          <button class="inspector-tab" data-tab="compiled">Compiled</button>
          <button id="inspectorToggle" class="inspector-collapse-btn" title="Hide Inspector">▼</button>
        </div>
        <div id="inspectorContent">

          <!-- Inspect Tab -->
          <div id="inspectPane" class="inspector-pane active">
            <div class="inspector-section">
              <button class="section-header" data-section="ast">
                <span class="section-title">AST</span>
                <span class="section-toggle">▼</span>
              </button>
              <div class="section-content" id="astViewer"></div>
            </div>
            <div class="inspector-section">
              <button class="section-header" data-section="graph">
                <span class="section-title">Render Graph</span>
                <span class="section-toggle">▼</span>
              </button>
              <div class="section-content collapsed" id="graphViewer"></div>
            </div>
            <div class="inspector-section">
              <button class="section-header" data-section="instances">
                <span class="section-title">Instances</span>
                <span class="section-toggle">▼</span>
              </button>
              <div class="section-content collapsed" id="instanceViewer"></div>
            </div>
          </div>

          <!-- Debug Tab -->
          <div id="debugPane" class="inspector-pane">
            <div id="logFilters">
              <label class="log-level-filter"><input type="checkbox" id="filterDebug" checked> Debug</label>
              <label class="log-level-filter"><input type="checkbox" id="filterInfo" checked> Info</label>
              <label class="log-level-filter"><input type="checkbox" id="filterWarn" checked> Warn</label>
              <label class="log-level-filter"><input type="checkbox" id="filterError" checked> Error</label>
              <span class="filter-separator">|</span>
              <button id="showAllComponents">All</button>
              <button id="hideAllComponents">None</button>
              <div id="componentFilterList"></div>
            </div>
            <div id="logOutput"></div>
          </div>

          <!-- Compiled Tab -->
          <div id="compiledPane" class="inspector-pane">
            <pre id="compiledCodeViewer"></pre>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Settings Menu (hidden by default) -->
  <div id="settingsMenu" class="menu hidden">
    <button id="autorunBtn" type="button">Auto</button>
    <button id="interpToggle" type="button">Smooth</button>
    <button id="probeToggle" type="button">Probe</button>
    <a href="https://github.com/leo-levin/weft#readme" target="_blank"><button type="button">Docs</button></a>
  </div>
</div>

<script src="https://unpkg.com/ohm-js@17/dist/ohm.min.js"></script>
<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<!-- WEFT syntax highlighting mode -->
<script type="module" src="mode-weft.js"></script>
<!-- Load new architecture modules -->
<script type="module" src="../src/ui/main-new.js"></script>
<script>
  window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
    if (e.error) {
      document.getElementById('errors').innerHTML = '<div style="color: red; padding: 10px; background: rgba(255,0,0,0.1); border-radius: 4px;">Module loading failed: ' + e.error.message + '<br>Check browser console for details.</div>';
    }
  });
</script>
</body>
</html>
